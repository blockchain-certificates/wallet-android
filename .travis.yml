dist: focal
language: android
jdk:
  - oraclejdk17

env:
  global:
    - TARGET_VERSION=35
    - ANDROID_BUILD_TOOLS_VERSION=35.0.0
    - ANDROID_HOME=$HOME/android-sdk

android:
  components:
    - build-tools;$ANDROID_BUILD_TOOLS_VERSION
    - platforms;android-$TARGET_VERSION
    - system-images;android-$TARGET_VERSION;google_apis;x86_64
    - extra-android-support
    - extra-google-m2repository
    - extra-android-m2repository
  licenses:
    - 'android-sdk-preview-license-52d11cd2'
    - 'android-sdk-license-.+'
    - 'google-gdk-license-.+'

git:
  submodules: false

before_install:
#  - mkdir -p $ANDROID_HOME/cmdline-tools
#  - wget https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip -O cmdline-tools.zip
#  - unzip -q cmdline-tools.zip -d $ANDROID_HOME/cmdline-tools
#  - mv $ANDROID_HOME/cmdline-tools/cmdline-tools $ANDROID_HOME/cmdline-tools/latest
#  - yes | $ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager --sdk_root=${ANDROID_HOME} "platforms;android-${TARGET_VERSION}" "build-tools;${ANDROID_BUILD_TOOLS_VERSION}" "platform-tools"
#
#  # Accept all SDK licenses
#  - yes | $ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager --licenses

  # Fix for Travis SSH URL in submodules
  - sed --in-place -e "s/git@github.com:/https:\/\/github.com\//" .gitmodules
  - git submodule update --init --recursive

jobs:
  include:
    - stage: test
      if: branch = master AND type = pull_request
      name: "Run Automated Tests: Master PR"
      script:
        - pushd LearningMachine
        - ./gradlew clean testDevDebug -PdisablePreDex -PdevBuild --console=plain
